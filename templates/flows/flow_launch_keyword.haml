-extends 'smartmin/update.html'

{% load smartmin temba compress i18n %}

-block pre-form
  :css
    .control-label {
      display: none !important;
    }
    .select2-container-multi .select2-choices .select2-search-field input.select2-active {
      background: none !important;
    }
    .launch-message {
      color: #569D9B;
      font-size: 15px;
      margin: 0 0 15px 0;
    }

-block fields
  -if object.flow_type == 'F' and not send_channel
    %p
    -blocktrans with name=brand.name
      To get started you need to add a channel to your account. A channel is a phone number or social network
      account which {{ name }} can use to send and receive messages on your behalf. You can choose to use an
      Android phone and your own cell phone plan, or we can connect you with a service provider in your country
      directly.
    %hr
    %p
      -trans "You can always test your flow using the simulator, click"
        %span.glyph.icon-mobile{style:"padding-top:2px;"}
      -trans "on the right to open it."

  -elif object.flow_type == 'U' and not is_ussd_channel
    %p
    -blocktrans with name=brand.name
      To get started you need to add a USSD channel to your account. You can choose between USSD channels
      that are available in your country.
    %hr
    %p
      -trans "You can always test your flow using the simulator, click"
        %span.glyph.icon-mobile{style:"padding-top:2px;"}
      -trans "on the right to open it."

  -elif object.flow_type == 'V' and not call_channel
    %p
      -blocktrans with name=brand.name
        To get started you need to add a voice-enabled channel to your account. A voice-enabled channel is a
        phone number which {{ name }} can use to make and receive phone calls on your behalf. For example, Twilio
        is a service which provides voice-enabled numbers which you can add as channels in your {{ name }} account.

  -else
    .launch-message
      -trans "To start the flow when someone sends a specific word, please specify the keyword(s) below."

    .field.keyword_triggers
      {% render_field 'keyword_triggers' %}

    #embedded-data.launch-flow-keyword
      .embed-row-keyword
        .embed-row-keyword-field
          %label
            -trans "Keyword"
        %select#embedded_keyword{name:'embedded_keyword'}
          %option{value:'default'}
            -trans "Default"
          -for keyword in current_keywords
            %option{value:"{{ keyword }}"}
              {{ keyword }}

      %div.embed-row-content.embed-row-content-default.active
        .embed-row.embed-template.embed-template-default
          .embed-field.embed-field-default
            %input{type:'text'}
          .embed-value.embed-value-default
            %input{type:'text'}
          .embed-remove{onclick:'removeEmbed($(this), "", "default")'}
            .icon.icon-close

        .embed-row.embed-header.embed-header-default.inactive
          .embed-field
            %label
              -trans "Embedded field"
          .embed-value
            %label
              -trans "Embedded value"

        .embed-container.embed-container-default

        .add-new-embed
          %a{href:'javascript:;', onclick:'addEmbed("", "", "", "default")'}
            -trans "Add embedded data"

      -for keyword in current_keywords
        %div{class:"embed-row-content embed-row-content-{{ keyword }}"}
          %div{class:"embed-row embed-template embed-template-{{ keyword }}"}
            %div{class:"embed-field embed-field-{{ keyword }}"}
              %input{type:'text'}
            %div{class:"embed-value embed-value-{{ keyword }}"}
              %input{type:'text'}
            .embed-remove{onclick:'removeEmbed($(this), "", "{{ keyword }}")'}
              .icon.icon-close

          %div{class:"embed-row embed-header embed-header-{{ keyword }} inactive"}
            .embed-field
              %label
                -trans "Embedded field"
            .embed-value
              %label
                -trans "Embedded value"

          %div{class:"embed-container embed-container-{{ keyword }}"}

          .add-new-embed
            %a{href:'javascript:;', onclick:'addEmbed("", "", "", "{{ keyword }}")'}
              -trans "Add embedded data"

-block form-buttons
  -if send_channel
    .form-actions
      %input.btn.btn-primary{type:"submit", value:"{{ submit_button_name }}"}

-block modal-script
  {{block.super}}

  %script{src:"{{ STATIC_URL }}js/embedded-data.js"}

  :javascript
  
    $(document).ready(function() {

      $('#id_keyword_triggers').select2({
        tags: [],
        tokenSeparators: [",", " "],
        minimumResultsForSearch: -1,
        placeholder: "Add a keyword to begin this flow",
        containerCssClass: "select2-temba-field"
      });
      $('#id_keyword_triggers').on('change', function (e) {
        if (e.added) {
          console.log(e.added);
        } else if (e.removed) {
          console.log(e.removed);
        }
      });

      $('#embedded_keyword').select2({
        containerCssClass: "select2-temba-field"
      });
      $('#embedded_keyword').on('change', function (e) {
        $('.embed-row-content-' + e.added.id).addClass('active');
        $('.embed-row-content-' + e.removed.id).removeClass('active');
      });

      addEmbed("", "", "", "default");
      {% for keyword in current_keywords %}
        addEmbed("", "", "", "{{ keyword }}");
      {% endfor %}
    });